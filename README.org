#+TITLE: Dotfiles
#+AUTHOR: Ishmael Aqsar

Configuration files, maintenance scripts, and GPG-backed secret management for my development environment.

* Bootstrap

To install on a fresh machine (macOS or Linux):

#+begin_src bash
  git clone https://github.com/ishmaelaqsar/dotfiles.git ~/workspace/.dotfiles
  ~/workspace/.dotfiles/install
#+end_src

The =install= script will:

1. Symlink all configurations from =dotfiles/= to your home directory.
2. Symlink scripts from =bin/= to =$HOME/bin= (or target directory).
3. *Configure GPG Agent* for SSH support and YubiKey usage (detects OS and pinentry).
4. *Install Git Hooks* to prevent committing unencrypted secrets.

* Secret Management

This repository uses a custom GPG + YubiKey workflow to store sensitive environment variables (API keys, tokens) securely in git.

** Prerequisites

- A *YubiKey* with your PGP private keys loaded.
- Your public key exported to =dotfiles/public.asc= (auto-imported during install).

** Yubikey required packages

The following packages are required to interface with the YubiKey:

*** Debian/Ubuntu

#+begin_src bash
  sudo apt update
  sudo apt install -y gnupg gnupg-agent scdaemon pcscd
#+end_src

*** Arch

#+begin_src bash
  sudo pacman -S --needed gnupg pcsc-tools
  sudo systemctl enable --now pcscd.service
#+end_src

*** macOS

#+begin_src bash
  brew install gnupg
#+end_src

** Initialise GnuPG

#+begin_src bash
  gpg -k
#+end_src

** Workflow

Add the helpers to your shell (already done if you source =.bash_profile=):

#+begin_src bash
  source ~/.helpers
#+end_src

| Action         | Command                       | Description                                                                         |
|----------------+-------------------------------+-------------------------------------------------------------------------------------|
| *Add Secret* | =add_secret KEY VALUE=        | Encrypts =VALUE= into =.secrets= and exports =KEY= to current shell.                |
| *Load Secrets* | =load_secrets=                | Decrypts all secrets into environment variables (prompts for YubiKey PIN once/day). |
| *Verify* | =bin/manage-secrets verify=   | Runs automatically on =git commit= to ensure no cleartext secrets are committed.    |

** Example

#+begin_src bash
  # Store a new key (requires YubiKey touch/PIN)
  add_secret OPENAI_API_KEY "sk-..."

  # Load keys at start of session
  load_secrets
#+end_src

* Repository Structure

- =dotfiles/=: Configuration files (=.bashrc=, =.vimrc=, etc.) symlinked to =$HOME=.
- =bin/=: Executable scripts symlinked to =$HOME/bin=.
- =install=: Main bootstrap script.

* Local Variables                                                   :noexport:
# Local Variables:
# tab-width: 8
# End:
