#!/usr/bin/env bash
set -euo pipefail

# -----------------------------
# Default target directory
# -----------------------------
TARGET_DIR="${1:-$HOME}"

# -----------------------------
# Absolute path to this script
# -----------------------------
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOTFILES_DIR="$HOME/.dotfiles/dotfiles"

# -----------------------------
# Sync dotfiles via Python
# -----------------------------
echo "Syncing dotfiles to $TARGET_DIR..."
if ! python3 "$SCRIPT_DIR/bin/sync-dotfiles" "$TARGET_DIR"; then
    echo "Error: sync-dotfiles failed. Aborting."
    exit 1
fi

# -----------------------------
# Git configuration
# -----------------------------
if command -v git &> /dev/null; then
    echo "Configuring global Git settings..."

    git config --global user.name "Ishmael Aqsar"
    git config --global user.email "ishmael-dev@aqsar.dev"
    git config --global core.excludesfile "$HOME/.gitignore_global"
    git config --global core.attributesfile "$HOME/.gitattributes"

    echo "Git configuration complete."
else
    echo "Git not found. Skipping git configuration."
fi

echo "Dotfiles installation complete."

